#!/bin/bash

# 1. –ü—Ä–æ–≤–µ—Ä–∫–∞, —á—Ç–æ —Ç—ã –≤ Git-—Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–∏
if [ ! -d .git ]; then
  echo "‚ùå –ó–¥–µ—Å—å –Ω–µ—Ç .git ‚Äî –≤—ã –Ω–µ –≤ –∫–æ—Ä–Ω–µ Git-—Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏—è"
  exit 1
fi

# 2. –£–¥–∞–ª–µ–Ω–∏–µ –±–∏–Ω–∞—Ä–Ω—ã—Ö —Ñ–∞–π–ª–æ–≤ –∏–∑ –∏—Å—Ç–æ—Ä–∏–∏
echo "üßπ –£–¥–∞–ª—è–µ–º mp4, onnx, pth –∏–∑ –∏—Å—Ç–æ—Ä–∏–∏..."
java -jar ~/bfg.jar --delete-files '*.{mp4,onnx,pth}' .

# 3. –û—á–∏—Å—Ç–∫–∞ reflog –∏ —É–¥–∞–ª–µ–Ω–∏–µ –º—É—Å–æ—Ä–∞
echo "üßº –û—á–∏—Å—Ç–∫–∞ reflog –∏ —É–¥–∞–ª–µ–Ω–∏–µ –º—É—Å–æ—Ä–∞..."
git reflog expire --expire=now --all
git gc --prune=now --aggressive

# 4. –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ä–∞–∑–º–µ—Ä–∞
echo "üì¶ –¢–µ–∫—É—â–∏–π —Ä–∞–∑–º–µ—Ä .git:"
du -sh .git

# 5. –§–æ—Ä—Å–∏—Ä–æ–≤–∞–Ω–Ω—ã–π push
echo "üöÄ –í—ã–ø–æ–ª–Ω—è–µ–º —Ñ–æ—Ä—Å–∏—Ä–æ–≤–∞–Ω–Ω—ã–π push..."
git push --force origin v1

echo "‚úÖ –ì–æ—Ç–æ–≤–æ!"
